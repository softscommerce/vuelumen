{"ast":null,"code":"import { times } from \"lodash\";\nimport AppStorage from \"./AppStorage\";\nimport Token from \"./Token\";\nimport axios from 'axios';\nimport { router } from 'vue-router';\n\nclass User {\n  login(data) {\n    axios.post('/api/login', data).then(res => this.responseAfterLogin(res)).catch(error => console.log(error.response.data));\n  }\n\n  register(data) {\n    axios.post('/api/register', data).then(res => this.responseAfterLogin(res)).catch(error => console.log(error.response.data));\n  }\n\n  responseAfterLogin(res) {\n    console.log(res);\n    const access_token = res.data.access_token;\n    const username = res.data.user.name;\n    const mobile = res.data.user.mobile;\n\n    if (Token.isValid(access_token)) {\n      AppStorage.store(username, access_token, mobile);\n    }\n\n    router.replace({\n      name: 'service'\n    });\n  }\n\n  hasToken() {\n    const storedToken = AppStorage.getToken();\n\n    if (storedToken) {\n      return Token.isValid(storedToken) ? true : this.logOut();\n    } else {\n      this.logOut();\n    }\n\n    return false;\n  }\n\n  logedIn() {\n    return this.hasToken();\n  }\n\n  logOut() {\n    AppStorage.clear(); // window.location = '/';\n  }\n\n  name() {\n    if (this.logedIn()) {\n      return AppStorage.getUser();\n    }\n  }\n\n  id() {\n    if (this.logedIn()) {\n      const payload = Token.payload(AppStorage.getToken());\n      return payload.sub;\n    }\n  }\n\n  own(id) {\n    return this.id() == id;\n  }\n\n  admin() {\n    return this.id() == 1;\n  }\n\n}\n\nexport default User = new User();","map":{"version":3,"names":["times","AppStorage","Token","axios","router","User","login","data","post","then","res","responseAfterLogin","catch","error","console","log","response","register","access_token","username","user","name","mobile","isValid","store","replace","hasToken","storedToken","getToken","logOut","logedIn","clear","getUser","id","payload","sub","own","admin"],"sources":["F:/softvue/src/middleware/User.js"],"sourcesContent":["import { times } from \"lodash\";\r\nimport AppStorage from \"./AppStorage\";\r\nimport Token from \"./Token\";\r\nimport axios from 'axios';\r\nimport {router} from 'vue-router';\r\n\r\nclass User{\r\n    login(data){\r\n        axios.post('/api/login',data)\r\n        .then(res => this.responseAfterLogin(res))\r\n        .catch(error => console.log(error.response.data))\r\n    }\r\n\r\n    register(data){\r\n        axios.post('/api/register',data)\r\n        .then(res => this.responseAfterLogin(res))\r\n        .catch(error => console.log(error.response.data))\r\n    }\r\n\r\n    responseAfterLogin(res){\r\n        console.log(res);\r\n        const access_token = res.data.access_token;\r\n        const username = res.data.user.name;\r\n        const mobile = res.data.user.mobile;\r\n\r\n        if(Token.isValid(access_token)){\r\n            AppStorage.store(username, access_token, mobile);\r\n        }\r\n        router.replace({name:'service'});\r\n    }\r\n\r\n\r\n    hasToken(){\r\n        const storedToken = AppStorage.getToken();\r\n        if(storedToken){\r\n          return Token.isValid(storedToken)? true : this.logOut();\r\n        }else{\r\n            this.logOut();\r\n\r\n        }\r\n        return false;\r\n    }\r\n\r\n\r\n    logedIn(){\r\n        return this.hasToken();\r\n    }\r\n\r\n    logOut(){\r\n        AppStorage.clear();\r\n        // window.location = '/';\r\n    }\r\n\r\n    name(){\r\n        if(this.logedIn()){\r\n            return AppStorage.getUser();\r\n        }\r\n    }\r\n\r\n    id(){\r\n        if(this.logedIn()){\r\n            const payload = Token.payload(AppStorage.getToken());\r\n            return payload.sub;\r\n        }\r\n    }\r\n\r\n    own(id){\r\n        return this.id() == id;\r\n    }\r\n\r\n    admin(){\r\n        return this.id() == 1;\r\n    }\r\n\r\n\r\n\r\n}\r\n\r\nexport default User = new User();"],"mappings":"AAAA,SAASA,KAAT,QAAsB,QAAtB;AACA,OAAOC,UAAP,MAAuB,cAAvB;AACA,OAAOC,KAAP,MAAkB,SAAlB;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,SAAQC,MAAR,QAAqB,YAArB;;AAEA,MAAMC,IAAN,CAAU;EACNC,KAAK,CAACC,IAAD,EAAM;IACPJ,KAAK,CAACK,IAAN,CAAW,YAAX,EAAwBD,IAAxB,EACCE,IADD,CACMC,GAAG,IAAI,KAAKC,kBAAL,CAAwBD,GAAxB,CADb,EAECE,KAFD,CAEOC,KAAK,IAAIC,OAAO,CAACC,GAAR,CAAYF,KAAK,CAACG,QAAN,CAAeT,IAA3B,CAFhB;EAGH;;EAEDU,QAAQ,CAACV,IAAD,EAAM;IACVJ,KAAK,CAACK,IAAN,CAAW,eAAX,EAA2BD,IAA3B,EACCE,IADD,CACMC,GAAG,IAAI,KAAKC,kBAAL,CAAwBD,GAAxB,CADb,EAECE,KAFD,CAEOC,KAAK,IAAIC,OAAO,CAACC,GAAR,CAAYF,KAAK,CAACG,QAAN,CAAeT,IAA3B,CAFhB;EAGH;;EAEDI,kBAAkB,CAACD,GAAD,EAAK;IACnBI,OAAO,CAACC,GAAR,CAAYL,GAAZ;IACA,MAAMQ,YAAY,GAAGR,GAAG,CAACH,IAAJ,CAASW,YAA9B;IACA,MAAMC,QAAQ,GAAGT,GAAG,CAACH,IAAJ,CAASa,IAAT,CAAcC,IAA/B;IACA,MAAMC,MAAM,GAAGZ,GAAG,CAACH,IAAJ,CAASa,IAAT,CAAcE,MAA7B;;IAEA,IAAGpB,KAAK,CAACqB,OAAN,CAAcL,YAAd,CAAH,EAA+B;MAC3BjB,UAAU,CAACuB,KAAX,CAAiBL,QAAjB,EAA2BD,YAA3B,EAAyCI,MAAzC;IACH;;IACDlB,MAAM,CAACqB,OAAP,CAAe;MAACJ,IAAI,EAAC;IAAN,CAAf;EACH;;EAGDK,QAAQ,GAAE;IACN,MAAMC,WAAW,GAAG1B,UAAU,CAAC2B,QAAX,EAApB;;IACA,IAAGD,WAAH,EAAe;MACb,OAAOzB,KAAK,CAACqB,OAAN,CAAcI,WAAd,IAA4B,IAA5B,GAAmC,KAAKE,MAAL,EAA1C;IACD,CAFD,MAEK;MACD,KAAKA,MAAL;IAEH;;IACD,OAAO,KAAP;EACH;;EAGDC,OAAO,GAAE;IACL,OAAO,KAAKJ,QAAL,EAAP;EACH;;EAEDG,MAAM,GAAE;IACJ5B,UAAU,CAAC8B,KAAX,GADI,CAEJ;EACH;;EAEDV,IAAI,GAAE;IACF,IAAG,KAAKS,OAAL,EAAH,EAAkB;MACd,OAAO7B,UAAU,CAAC+B,OAAX,EAAP;IACH;EACJ;;EAEDC,EAAE,GAAE;IACA,IAAG,KAAKH,OAAL,EAAH,EAAkB;MACd,MAAMI,OAAO,GAAGhC,KAAK,CAACgC,OAAN,CAAcjC,UAAU,CAAC2B,QAAX,EAAd,CAAhB;MACA,OAAOM,OAAO,CAACC,GAAf;IACH;EACJ;;EAEDC,GAAG,CAACH,EAAD,EAAI;IACH,OAAO,KAAKA,EAAL,MAAaA,EAApB;EACH;;EAEDI,KAAK,GAAE;IACH,OAAO,KAAKJ,EAAL,MAAa,CAApB;EACH;;AAlEK;;AAwEV,eAAe5B,IAAI,GAAG,IAAIA,IAAJ,EAAtB"},"metadata":{},"sourceType":"module"}